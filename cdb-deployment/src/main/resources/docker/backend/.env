# CDB Platform master .env
#
# This file centralizes environment variables for all Spring Boot backend services.
# It is structured with a Global section first (shared defaults), followed by
# per-component sections separated by a clear line of ======== characters.
#
# Usage:
# - docker compose automatically loads this .env file when run from this directory.
# - Each service can override any global value via its own *_VAR names.
# - Precedence (highest to lowest): explicitly set shell env > per-service var > global var > image default/application.yml default.
#
# Database configuration model:
# - Preferred global variables: CDB_DB_URL, CDB_DB_HOST, CDB_DB_PORT, CDB_DB_USERNAME, CDB_DB_PASSWORD, CDB_DB_DRIVER
# - Per-service overrides exist (e.g., CDB_PROVIDER_REGISTRY_DB_URL). If set, they take precedence.
# - Alias provided: CDB__DB_URL mirrors CDB_DB_URL to assist tools that expect double underscores.
#   Note: Spring Boot maps dots to single underscores (e.g., spring.datasource.url -> SPRING_DATASOURCE_URL),
#   and our application.yml reads CDB_DB_URL. We include CDB__DB_URL as a convenience alias.
#
# JWT keys:
# - For production, set CDB_SECURITY_JWT_RSA_PUBLIC_KEY for all services and
#   CDB_SECURITY_JWT_RSA_PRIVATE_KEY only for the Auth service. Optionally set CDB_SECURITY_JWT_KID.
# - Values can be multi-line PEMs; compose accepts literal newlines if provided via environment export
#   before invoking compose, or you can place single-line base64 and decode in wrappers.
#
# Logging:
# - Each service writes logs under /var/log/cdb/<service>; compose mounts ./logs accordingly.
#
# Resource limits:
# - Documented in docker-compose.yml under deploy.resources.limits (effective in Swarm).

############################## GLOBAL (shared defaults) ##############################
# Common DB (used when a service-specific *_DB_URL is not set)
# For containers to reach a DB on the host machine, use host.docker.internal (mapped via docker host-gateway)
CDB_DB_HOST=192.168.1.53
CDB_DB_PORT=3306
CDB_DB_USERNAME=root
CDB_DB_PASSWORD=root
CDB_DB_DRIVER=com.mysql.cj.jdbc.Driver

# JWT (shared public for validators; private only needed by Auth service)
CDB_SECURITY_JWT_RSA_PUBLIC_KEY=
CDB_SECURITY_JWT_RSA_PRIVATE_KEY=
CDB_SECURITY_JWT_KID=


# ================================= cdb-api-gateway =================================
# Port and naming
CDB_API_GATEWAY_PORT=8080
CDB_API_GATEWAY_NAME=cdb-api-gateway
# CORS and discovery
CDB_GATEWAY_DISCOVERY_ENABLED=true
# Rate limiting
CDB_GATEWAY_RATE_LIMITING_ENABLED=true
CDB_GATEWAY_RATE_LIMIT=100
# Logging (path is inside container; compose maps to ./logs)
CDB_GATEWAY_LOG_PATTERN="%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
CDB_GATEWAY_LOG_FILE_PATTERN="%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
CDB_GATEWAY_LOG_FILE=/var/log/cdb/cdb-api-gateway/cdb-api-gateway.log
CDB_GATEWAY_ROOT_LOG_LEVEL=INFO
CDB_GATEWAY_LOG_MAX_FILE_SIZE=10MB
CDB_GATEWAY_LOG_MAX_HISTORY=30
CDB_GATEWAY_LOG_TOTAL_SIZE_CAP=1GB
# ================================ cdb-auth-registry ================================
# Port and naming
CDB_AUTH_REGISTRY_PORT=8083
CDB_AUTH_REGISTRY_NAME=cdb-auth-registry
CDB_AUTH_REGISTRY_DB_URL="jdbc:mysql://${CDB_DB_HOST}:${CDB_DB_PORT}/cdb_auth_registry_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC"
CDB_AUTH_REGISTRY_DB_USERNAME="${CDB_DB_USERNAME}"
CDB_AUTH_REGISTRY_DB_PASSWORD="${CDB_DB_PASSWORD}"
CDB_AUTH_REGISTRY_DB_DRIVER=com.mysql.cj.jdbc.Driver

# JPA
CDB_AUTH_REGISTRY_JPA_DDL_AUTO=none
# Tokens TTL (seconds)
CDB_AUTH_JWT_ACCESS_TTL=86400
CDB_AUTH_OAUTH2_ACCESS_TTL=86400
CDB_AUTH_JWT_REFRESH_TTL=864000
# Logging
CDB_AUTH_REGISTRY_ROOT_LOG_LEVEL=INFO
CDB_AUTH_REGISTRY_LOG_PATTERN="%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
CDB_AUTH_REGISTRY_LOG_FILE_PATTERN="%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
CDB_AUTH_REGISTRY_LOG_FILE=/var/log/cdb/cdb-auth-registry/cdb-auth-registry.log
CDB_AUTH_REGISTRY_LOG_MAX_FILE_SIZE=10MB
CDB_AUTH_REGISTRY_LOG_MAX_HISTORY=30
CDB_AUTH_REGISTRY_LOG_TOTAL_SIZE_CAP=1GB

# ================================ cdb-api-registry =================================
# Port and naming
CDB_API_REGISTRY_PORT=8082
CDB_API_REGISTRY_NAME=cdb-api-registry
# DB
CDB_API_REGISTRY_DB_URL="jdbc:mysql://${CDB_DB_HOST}:${CDB_DB_PORT}/cdb_api_registry_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC"
CDB_API_REGISTRY_DB_USERNAME="${CDB_DB_USERNAME}"
CDB_API_REGISTRY_DB_PASSWORD="${CDB_DB_PASSWORD}"
CDB_API_REGISTRY_DB_DRIVER=com.mysql.cj.jdbc.Driver
# JPA
CDB_API_REGISTRY_JPA_DDL_AUTO=none
# Logging
CDB_API_REGISTRY_ROOT_LOG_LEVEL=INFO
CDB_API_REGISTRY_LOG_PATTERN="%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
CDB_API_REGISTRY_LOG_FILE_PATTERN="%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
CDB_API_REGISTRY_LOG_FILE=/var/log/cdb/cdb-api-registry/cdb-api-registry.log
CDB_API_REGISTRY_LOG_MAX_FILE_SIZE=10MB
CDB_API_REGISTRY_LOG_MAX_HISTORY=30
CDB_API_REGISTRY_LOG_TOTAL_SIZE_CAP=1GB

# =============================== cdb-provider-registry ==============================
# Port and naming
CDB_PROVIDER_REGISTRY_PORT=8081
CDB_PROVIDER_REGISTRY_NAME=cdb-provider-registry

# DB
CDB_PROVIDER_REGISTRY_DB_URL="jdbc:mysql://${CDB_DB_HOST}:${CDB_DB_PORT}/cdb_provider_registry_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC"
CDB_PROVIDER_REGISTRY_DB_USERNAME="${CDB_DB_USERNAME}"
CDB_PROVIDER_REGISTRY_DB_PASSWORD="${CDB_DB_PASSWORD}"
CDB_PROVIDER_REGISTRY_DB_DRIVER=com.mysql.cj.jdbc.Driver
# JPA
CDB_PROVIDER_REGISTRY_JPA_DDL_AUTO=none
CDB_PROVIDER_REGISTRY_JPA_SHOW_SQL=false
# Inter-service URLs (use service DNS on the cdb network)
CDB_AUTH_REGISTRY_BASE_URL=https://cdb-auth-registry:8083
# Logging
CDB_PROVIDER_REGISTRY_ROOT_LOG_LEVEL=INFO
CDB_PROVIDER_LOG_PATTERN="%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
CDB_PROVIDER_LOG_FILE_PATTERN="%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
CDB_PROVIDER_REGISTRY_LOG_FILE=/var/log/cdb/cdb-provider-registry/cdb-provider-registry.log
CDB_PROVIDER_REGISTRY_LOG_MAX_FILE_SIZE=10MB
CDB_PROVIDER_REGISTRY_LOG_MAX_HISTORY=30
CDB_PROVIDER_REGISTRY_LOG_TOTAL_SIZE_CAP=1GB

# ============================== cdb-master-data-engine ==============================
# Port and naming
CDB_MASTER_DATA_ENGINE_PORT=8084
CDB_MASTER_DATA_ENGINE_NAME=cdb-master-data-engine
# DB
CDB_MASTER_DATA_ENGINE_DB_URL="jdbc:mysql://${CDB_DB_HOST}:${CDB_DB_PORT}/cdb_master_data_engine_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC"
CDB_MASTER_DATA_ENGINE_DB_USERNAME="${CDB_DB_USERNAME}"
CDB_MASTER_DATA_ENGINE_DB_PASSWORD="${CDB_DB_PASSWORD}"
CDB_MASTER_DATA_ENGINE_DB_DRIVER=com.mysql.cj.jdbc.Driver
# JPA
CDB_MASTER_DATA_ENGINE_JPA_DDL_AUTO=none
CDB_MASTER_DATA_ENGINE_JPA_SHOW_SQL=false
# Logging
CDB_MASTER_DATA_ENGINE_ROOT_LOG_LEVEL=INFO
CDB_MASTER_DATA_LOG_FILE=/var/log/cdb/cdb-master-data-engine/cdb-master-data-engine.log
CDB_MASTER_DATA_LOG_PATTERN="%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
CDB_MASTER_DATA_LOG_FILE_PATTERN="%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
CDB_MASTER_DATA_LOG_MAX_FILE_SIZE=10MB
CDB_MASTER_DATA_LOG_MAX_HISTORY=30
CDB_MASTER_DATA_LOG_TOTAL_SIZE_CAP=1GB
